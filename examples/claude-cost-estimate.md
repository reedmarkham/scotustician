# AWS Cost Analysis: Scotustician Pipeline

*Generated by Claude Code on 2025-08-07*

## Overview

This document provides detailed cost estimates for running the Scotustician SCOTUS oral argument processing pipeline on AWS. The pipeline consists of two main components:

1. **Ingest Service** - Collects oral argument data from Oyez.org API
2. **Transformers Service** - Generates embeddings using BGE-M3 model

## 💰 Cost Breakdown

### Ingest Job Costs

**Configuration:**
- AWS Fargate: 1 vCPU + 3GB RAM
- Cost: **$0.054/hour**

**Scenarios:**

*Note: Duration estimates account for Oyez.org API rate limiting (~1-2 requests/second)*  
*API reliably provides data from 1980 onwards (~45 terms, ~3,600 cases total)*

| Scenario | Cases | Duration | Total Cost | Cost/Case |
|----------|-------|----------|------------|-----------|
| Single term (2023-24) | 90 | 1.5 hours | **$0.08** | $0.0009 |
| 5 years (2019-24) | 450 | 6.0 hours | **$0.32** | $0.0007 |
| 10 years (2014-24) | 900 | 12.0 hours | **$0.65** | $0.0007 |
| Full available data (1980-24) | 3,600 | 40.0 hours | **$2.16** | $0.0006 |

**Scheduled Operations:**
- **Frequency:** 2x/week (Monday & Thursday, 10 AM UTC)
- **Duration:** 5-15 minutes (incremental updates only)
- **Cost per run:** $0.013
- **Monthly cost:** ~$0.11

### Transformers Job Costs

**Configurations:**

**CPU-Only (AWS Fargate):**
- 2 vCPUs + 8GB RAM
- Cost: **$0.117/hour**

**GPU-Enabled (EC2 Spot):**
- g4dn.xlarge instance
- Cost: **~$0.20/hour** (spot pricing, ~70% savings vs on-demand)

**Processing Scenarios:**

| Job Size | CPU Cost | CPU Time | GPU Cost | GPU Time | GPU Savings |
|----------|----------|----------|----------|----------|-------------|
| **100 cases** | $0.07 | 0.6 hours | **$0.03** | 0.15 hours | $0.04 (57%) |
| **1,000 cases** | $0.69 | 5.9 hours | **$0.30** | 1.5 hours | $0.39 (57%) |
| **5,000 cases** | $3.45 | 29.6 hours | **$1.48** | 7.4 hours | $1.97 (57%) |

## 💾 Storage Costs (Monthly)

**Per 1,000 cases:**
- S3 storage (JSON + XML): ~$0.02/month
- ECR container images: ~$0.20/month
- **Total storage:** ~$0.22/month per 1,000 cases

## 🏗️ Infrastructure Costs (Monthly)

### Core Infrastructure Components

The Scotustician pipeline relies on several AWS infrastructure components that incur monthly costs regardless of processing volume:

**Networking & VPC:**
- **VPC with 2 AZs:** Free
- **Public/Private Subnets:** Free
- **Internet Gateway:** Free
- **VPC Endpoints:** $7.20/month per endpoint × 5 endpoints = **$36.00/month**
  - S3 Gateway Endpoint: Free
  - ECR Interface Endpoint: $7.20/month
  - ECR Docker Interface Endpoint: $7.20/month
  - CloudWatch Logs Interface Endpoint: $7.20/month
  - Secrets Manager Interface Endpoint: $7.20/month

**Database (PostgreSQL with pgvector):**
- **RDS PostgreSQL instance:** Deployed separately via [scotustician-db](https://github.com/reedmarkham/scotustician-db)
- Estimated cost for db.t3.micro: **$12.00/month**
- Storage (20GB): **$2.30/month**
- **Database total:** **~$14.30/month**

**Container Orchestration:**
- **ECS Clusters:** Free (no running tasks)
- **Fargate tasks:** Pay-per-use (covered in compute costs)
- **AWS Batch:** Free (compute environment only charged when running)

**Monitoring & Logging:**
- **CloudWatch Log Groups:** $0.50/GB ingested + $0.03/GB stored
- **CloudWatch Alarms:** $0.10/alarm/month × 2 alarms = **$0.20/month**
- **Log retention:** 1 week retention minimizes storage costs
- **Estimated logging:** **$1.00-3.00/month** (varies by processing volume)

**Security & Secrets:**
- **AWS Secrets Manager:** $0.40/secret/month × 1 secret = **$0.40/month**
- **Security Groups & IAM:** Free

**Message Queues:**
- **SQS Queues:** 2 queues (processing + checkpoints)
- **Free tier:** 1M requests/month
- **Estimated cost:** **$0.00-0.10/month** (within free tier for typical usage)

### Infrastructure Cost Summary

| Component | Monthly Cost |
|-----------|-------------|
| **VPC Endpoints** | $36.00 |
| **Database (RDS)** | $14.30 |
| **CloudWatch & Logging** | $1.50 |
| **Secrets Manager** | $0.40 |
| **SQS Queues** | $0.05 |
| **Total Infrastructure** | **$52.25/month** |

## 🎯 Real-World Cost Examples

### Scenario 1: Research Project (500 cases)
```
Initial Setup:
• Ingest: 500 cases × $0.0007 = $0.35
• Transform: 500 cases (GPU) = $0.15
• Storage: $0.11/month
• Infrastructure: $52.25/month
• Total first month: $52.86
```

### Scenario 2: Full Available Dataset (3,600 cases, 1980-2024)
```
Initial Setup:
• Ingest: 3,600 cases = $2.16
• Transform: 3,600 cases (GPU) = $1.07
• Storage: $0.80/month
• Infrastructure: $52.25/month
• Total first month: $56.28
```

### Scenario 3: Production with Updates
```
Monthly Operations:
• Scheduled ingest: $0.11/month
• New case processing: ~$0.05/month
• Storage: $0.44/month (2k cases)
• Infrastructure: $52.25/month
• Total ongoing: $52.85/month
```

## 📊 Key Insights

### Cost Optimization Recommendations

**For Processing Costs:**
1. **Use GPU for medium-large jobs** (>500 cases)
   - 4x faster processing
   - 57% cost savings despite higher hourly rate

2. **Leverage Spot Instances** (already configured)
   - ~70% savings over on-demand pricing
   - Automatic failover to on-demand if needed

3. **Batch Processing**
   - Minimize container startup overhead
   - Process multiple cases per job invocation

4. **Incremental Updates**
   - Scheduled jobs only process new cases
   - Extremely low ongoing processing costs

**For Infrastructure Costs:**
1. **Consider VPC Endpoint Trade-offs**
   - Remove VPC endpoints: Save $36/month, add NAT Gateway costs (~$45/month)
   - Net effect: Slightly higher cost but simplified architecture

2. **Database Right-sizing**
   - Start with db.t3.nano ($6/month) for development
   - Scale to db.t3.micro ($12/month) for production
   - Monitor and adjust based on actual usage

3. **Shared Infrastructure**
   - Deploy [scotustician-db](https://github.com/reedmarkham/scotustician-db) once
   - Share across multiple projects/researchers
   - Amortize infrastructure costs

4. **Usage-based Deployment**
   - Consider serverless alternatives for infrequent use
   - Deploy infrastructure only when needed for large processing jobs

### Cost Comparison with Alternatives

**vs. Running Locally:**
- No hardware depreciation costs
- No electricity/cooling costs  
- Pay-per-use model
- Professional-grade infrastructure

**vs. Other Cloud Providers:**
- AWS Fargate pricing competitive
- Spot instance savings significant
- Integrated S3/ECR ecosystem

## 🚀 Scalability Analysis

The pipeline scales cost-effectively, with infrastructure representing the primary ongoing cost:

| Dataset Size | One-time Setup (Compute + Storage) | Monthly Ongoing (Total) |
|--------------|-------------------------------------|-------------------------|
| **Small** (100 cases) | $0.15 | $52.38 |
| **Medium** (1,000 cases) | $1.00 | $52.58 |
| **Large** (3,600 cases, full available) | $4.03 | $53.16 |

**Key Insight:** Infrastructure costs ($52.25/month) dominate total expenses, making processing costs relatively insignificant for ongoing operations.

## 💡 Cost Control Features

**Built-in Cost Controls:**
- Spot instance automatic bidding
- Container resource limits prevent runaway costs
- Fargate eliminates idle server costs
- S3 lifecycle policies for long-term storage
- 1-week log retention minimizes CloudWatch costs
- VPC endpoints reduce NAT Gateway costs

**Monitoring:**
- CloudWatch cost alerts and alarms ($0.20/month)
- ECS task execution logs with automatic cleanup
- Automatic scaling based on demand

**Infrastructure Optimization Options:**
- **VPC Endpoints:** Can be removed to save $36/month, but increases NAT Gateway costs (~$45/month)
- **Database sizing:** Can downgrade to db.t3.nano ($6/month) for light workloads
- **Log retention:** Reduce to 3 days to minimize CloudWatch costs

---

## Summary

The Scotustician pipeline has **two cost components**:

### Compute Costs (One-time & Variable)
- **Initial setup:** $0.15 - $4.03 depending on dataset size
- **Processing cost per case:** ~$0.0006 - $0.0010
- **Storage costs:** Negligible (~$0.22/month per 1,000 cases)

### Infrastructure Costs (Fixed Monthly)
- **Core infrastructure:** $52.25/month
- **Includes:** VPC endpoints, RDS database, monitoring, secrets management
- **Unavoidable for production deployment**

### Total Cost Reality
- **First month (any size):** $52.40 - $56.28
- **Ongoing monthly:** $52.25 - $53.16
- **Infrastructure dominates costs:** ~98% of monthly expenses

**Key considerations:**
- Infrastructure costs are fixed regardless of usage volume
- Processing costs become insignificant compared to infrastructure
- Best suited for continuous operation or high-volume processing
- Consider shared infrastructure or serverless alternatives for light usage
- API rate limiting makes ingest jobs run 3-4x longer than pure compute time
- GPU-enabled transformers provide significant time and cost savings for processing

*The pipeline is cost-effective for production workloads but may be expensive for occasional research use due to fixed infrastructure costs. Consider the [scotustician-db](https://github.com/reedmarkham/scotustician-db) shared infrastructure model for multiple projects.*